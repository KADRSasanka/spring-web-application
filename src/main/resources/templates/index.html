<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <div class="d-flex justify-content-between align-items-center px-3 mt-3">
        <!-- Left toggle button -->
        <!-- ADMIN: enabled -->
        <a th:href="@{/admin}"
           class="btn btn-light toggle-btn-left"
           id="leftThemeToggle1"
           sec:authorize="hasRole('ADMIN')">
            ADMIN
        </a>

        <!-- USER: disabled -->
        <button class="btn btn-light toggle-btn-left"
                id="leftThemeToggle2"
                disabled
                title="Only admins can access this page"
                sec:authorize="hasRole('USER')">
            ADMIN
        </button>
        <!--
                <div th:if="${param.unauthorized}"
                     class="alert alert-danger alert-dismissible fade show"
                     role="alert">
                    <strong>You are not Authorized!</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>-->

        <!-- Right toggle button -->
        <button class="btn btn-light toggle-btn-right" id="themeToggle">
            ðŸŒ™ Dark Mode
        </button>
    </div>

    <div class="container-fluid">

        <h1 class="text-center mt-4 mb-2">EVENT MANAGEMENT SYSTEM</h1>

        <p class="text-center" sec:authorize="isAuthenticated()">
            <strong>
                â˜¬
                <span class="text-uppercase" sec:authentication="principal.firstName"></span>
                <span class="text-uppercase" sec:authentication="principal.lastName"></span>
                â˜¬
            </strong>
        </p>

        <div class="col-6">
            <a class="btn btn-outline-primary col-6 mx-auto mb-3" href="/index/add" role="button" data-bs-toggle="modal"
               data-bs-target="#addEventModal">ADD AN EVENT</a>
        </div>

        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">EVENT CODE</th>
                <th scope="col">EVENT NAME</th>
                <th scope="col">VENUE</th>
                <th scope="col">PROJECT CHAIR</th>
                <th scope="col">TIME RANGE</th>
                <th scope="col">STATUS</th>
                <th scope="col">ACTIONS</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="event : ${events}">
                <td th:text="${event.id}">1</td>
                <td th:text="${event.eventCode}">EVT-001</td>
                <td th:text="${event.eventName}">Event Name</td>
                <td th:text="${event.venue}">Venue</td>
                <td th:text="${event.projectChair != null
                    ? event.projectChair.firstName + ' ' + event.projectChair.lastName
                    : 'N/A'}">
                </td>
                <td>
                    <span th:text="${event.startDate}"></span>
                    -
                    <span th:text="${event.endDate}"></span>
                </td>
                <td>
                    <span class="badge"
                          th:switch="${event.status.name()}">
                        <span th:case="'UPCOMING'" class="badge badge-font bg-info">UPCOMING</span>
                        <span th:case="'ONGOING'" class="badge badge-font bg-primary">ONGOING</span>
                        <span th:case="'COMPLETED'" class="badge badge-font bg-success">COMPLETED</span>
                        <span th:case="'POSTPONED'" class="badge badge-font bg-warning text-dark">POSTPONED</span>
                        <span th:case="'CANCELLED'" class="badge badge-font bg-danger">CANCELLED</span>
                        <span th:case="'DRAFT'" class="badge badge-font bg-secondary">DRAFT</span>
                    </span>
                </td>
                <td>
                    <button class="btn btn-warning btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#editEventModal"
                            th:attr="data-id=${event.id},
                                     data-code=${event.eventCode},
                                     data-name=${event.eventName},
                                     data-venue=${event.venue},
                                     data-chair=${event.projectChair},
                                     data-status=${event.status},
                                     data-start=${event.startDate},
                                     data-end=${event.endDate}">
                            Edit
                    </button>

                    <a th:href="@{/events/delete/{id}(id=${event.id})}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('Are you sure?')">
                        Delete
                    </a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(events)}">
                <td colspan="8" class="text-center text-muted">
                    No events found
                </td>
            </tr>
            </tbody>
        </table>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/script.js}"></script>

    <!-- Center Appeared Add Modal Form -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content bg-dark text-light border-secondary">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h5 class="modal-title">Add New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Modal Body -->
                <form th:action="@{/index/save}" method="post">
                    <div class="modal-body">

                        <div class="mb-3">
                            <label class="form-label">Event Code</label>
                            <input type="text" name="eventCode" class="form-control bg-dark text-light border-secondary" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Event Name</label>
                            <input type="text" name="eventName" class="form-control bg-dark text-light border-secondary" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Venue</label>
                            <input type="text" name="venue" class="form-control bg-dark text-light border-secondary">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Project Chair</label>
                            <input type="text" name="projectChair" class="form-control bg-dark text-light border-secondary">
                        </div>

                        <div class="row">
                            <div class="col">
                                <label class="form-label">Start Date</label>
                                <input type="date" name="startDate" class="form-control bg-dark text-light border-secondary">
                            </div>
                            <div class="col">
                                <label class="form-label">End Date</label>
                                <input type="date" name="endDate" class="form-control bg-dark text-light border-secondary">
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label">Status</label>
                            <select name="status" class="form-select bg-dark text-light border-secondary">
                                <option value="DEFAULT" disabled> -- Select Status -- </option>
                                <option value="UPCOMING">Upcoming</option>
                                <option value="ONGOING">Ongoing</option>
                                <option value="COMPLETED">Completed</option>
                                <option value="POSTPONED">Postponed</option>
                                <option value="CANCELLED">Cancelled</option>
                                <option value="DRAFT">Draft</option>
                            </select>
                        </div>

                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer border-secondary">
                        <button type="button" class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-outline-success">
                            ðŸ’¾ Save Event
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <!-- Center appeared Edit Modal Form -->
    <div class="modal fade" id="editEventModal" tabindex="-1"
         <!--th:classappend="${editMode} ? 'show d-block' : ''"-->>

        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-secondary themed-modal">

            <div class="modal-header border-secondary">
                    <h5 class="modal-title">Edit Event</h5>
                    <!--<a href="/index" class="btn-close btn-close-white"></a>-->
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <form th:action="@{/index/update/{id}(id=${event.id})}" method="post">
                    <div class="modal-body">

                        <input type="hidden" name="id" th:value="${event.id}"/>

                        <div class="mb-3">
                            <label class="form-label">Event Code</label>
                            <input type="text" name="eventCode"
                                   th:value="${event.eventCode}"
                                   class="form-control bg-dark text-light border-secondary">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Event Name</label>
                            <input type="text" name="eventName"
                                   th:value="${event.eventName}"
                                   class="form-control bg-dark text-light border-secondary">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Venue</label>
                            <input type="text" name="venue"
                                   th:value="${event.venue}"
                                   class="form-control bg-dark text-light border-secondary">
                        </div>

                        <div class="row">
                            <div class="col">
                                <label class="form-label">Start Date</label>
                                <input type="date" name="startDate"
                                       th:value="${event.startDate}"
                                       class="form-control bg-dark text-light border-secondary">
                            </div>
                            <div class="col">
                                <label class="form-label">End Date</label>
                                <input type="date" name="endDate"
                                       th:value="${event.endDate}"
                                       class="form-control bg-dark text-light border-secondary">
                            </div>
                        </div>

                        <div class="mt-3">
                            <label class="form-label">Status</label>
                            <select name="status"
                                    class="form-select bg-dark text-light border-secondary">
                                <option th:each="s : ${T(com.deaprj.spring_web_application.models.EventStatus).values()}"
                                        th:value="${s}"
                                        th:text="${s}"
                                        th:selected="${s == event.status}">
                                </option>
                            </select>
                        </div>

                    </div>

                    <div class="modal-footer border-secondary">
                        <!--<a href="/index" class="btn btn-outline-secondary">Cancel</a>-->
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-outline-warning">
                            ðŸ’¾ Update Event
                        </button>
                    </div>
                </form>

            </div>
        </div>
    </div>

</body>
</html>
