<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <div class="d-flex justify-content-between align-items-center px-3 mt-3">
        <!-- Left toggle button -->
        <!-- ADMIN: enabled -->
        <a th:href="@{/admin}"
           class="btn btn-light toggle-btn-left"
           id="leftThemeToggle1"
           sec:authorize="hasRole('ADMIN')">
            ADMIN
        </a>

        <!-- USER: disabled -->
        <button class="btn btn-light toggle-btn-left"
                id="leftThemeToggle2"
                disabled
                title="Only admins can access this page"
                sec:authorize="hasRole('USER')">
            ADMIN
        </button>
        <!--
                <div th:if="${param.unauthorized}"
                     class="alert alert-danger alert-dismissible fade show"
                     role="alert">
                    <strong>You are not Authorized!</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>-->

        <!-- Right toggle button -->
        <button class="btn btn-light toggle-btn-right" id="themeToggle">
            üåô Dark Mode
        </button>
    </div>

    <div class="container-fluid">

        <h1 class="text-center mt-4 mb-2 bungee">EVENT MANAGEMENT SYSTEM</h1>

        <p class="text-center" sec:authorize="isAuthenticated()">
            <strong>
                ‚ò¨
                <span class="text-uppercase" sec:authentication="principal.firstName"></span>
                <span class="text-uppercase" sec:authentication="principal.lastName"></span>
                ‚ò¨
            </strong>
        </p>

        <div class="col-6">
            <a class="btn btn-outline-primary col-6 mx-auto mb-3" href="/index" role="button">CREATE/ MANAGE EVENTS</a>
        </div>

        <hr class="border-light border-3 my-4"> <!-- Blue, thicker line -->

        <!-- STATISTICS DASHBOARD -->
        <h2 class="my-2"> GLIMPSE OF EVENTS </h2>

        <div class="container my-4">

            <div class="row g-4 text-center">

                <div class="col-md-3">
                    <div class="stat-card stat-card-tot">
                        <h2 th:text="${totalEvents}">0</h2>
                        <p>Total Events</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="stat-card stat-card-up">
                        <h2 th:text="${upcomingEvents}">0</h2>
                        <p>Upcoming Events</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="stat-card stat-card-on">
                        <h2 th:text="${ongoingEvents}">0</h2>
                        <p>Ongoing Events</p>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="stat-card stat-card-com">
                        <h2 th:text="${completedEvents}">0</h2>
                        <p>Completed Events</p>
                    </div>
                </div>

            </div>

        </div>


        <hr class="border-light border-3 my-4"> <!-- Blue, thicker line -->

        <h2 class="my-2"> FEATURED EVENTS </h2>

        <div class="container mt-4">

            <div class="row" th:if="${featuredEvents != null and !#lists.isEmpty(featuredEvents)}">
                <div class="col-md-4 mb-4" th:each="event : ${featuredEvents}">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title text-uppercase" th:text="${event.eventName}">Event Name</h5>
                            <p class="card-text">üìç <span th:text="${event.venue}">Venue</span></p>
                            <p class="text-muted small">
                                üìÖ <span th:text="${event.startDate}"></span>
                                <span th:if="${event.endDate != null}"> - <span th:text="${event.endDate}"></span></span>
                            </p>
                            <span class="badge bg-info text-dark" th:text="${event.status}">STATUS</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- If no events -->
            <p class="text-muted" th:if="${events == null or #lists.isEmpty(events)}">
                No events available at the moment.
            </p>

        </div>

        <hr class="border-light border-3 my-4"> <!-- Blue, thicker line -->

        <!-- EVENT STATUS DOUGHNUT CHART -->
        <div class="container my-5">

            <div class="row gap-5 align-items-stretch">

                <!-- LEFT : Doughnut Chart -->
                <div class="col-12 col-md-5">
                    <div class="chart-card align-items-center justify-content-center">

                        <canvas id="eventStatusChart"
                                th:attr="
                               data-upcoming=${upcomingEvents},
                               data-ongoing=${ongoingEvents},
                               data-completed=${completedEvents},
                               data-postponed=${postponedEvents},
                               data-cancelled=${cancelledEvents}">
                        </canvas>

                    </div>
                </div>

                <!-- RIGHT : Announcements -->
                <div class="col-12 col-md-5">
                    <div class="announcement-card h-100">
                        <h4 class="announcement-title text-uppercase">Announcements</h4>
                        <div class="announcement-item">
                            <p class="announcement-main">
                                This feature will be available soon...
                            </p>
                            <p class="announcement-sub">
                                Digital Services Team
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <hr class="border-light border-3 my-4"> <!-- Blue, thicker line -->

        <h2 class="my-2"> EVENTS OVERVIEW </h2>

        <div class="my-4 card-body table-responsive rounded-4">
            <table class="table table-hover align-middle mb-0 rounded-3">
                <thead class="table-light">
                <tr>
                    <th>Event Code</th>
                    <th>Event Name</th>
                    <th>Venue</th>
                    <th>Project Chair</th>
                    <th>Status</th>
                </tr>
                </thead>

                <tbody id="events-table-body">
                <tr th:each="event : ${events}">
                    <td th:text="${event.eventCode}">EVT-001</td>
                    <td th:text="${event.eventName}">Event Name</td>
                    <td th:text="${event.venue}">Venue</td>
                    <td th:text="${event.projectChair != null
                        ? event.projectChair.firstName + ' ' + event.projectChair.lastName
                        : 'N/A'}">
                    </td>
                    <td>
                        <span class="badge"
                              th:switch="${event.status.name()}">
                            <span th:case="'UPCOMING'" class="badge badge-font bg-info">UPCOMING</span>
                            <span th:case="'ONGOING'" class="badge badge-font bg-primary">ONGOING</span>
                            <span th:case="'COMPLETED'" class="badge badge-font bg-success">COMPLETED</span>
                            <span th:case="'POSTPONED'" class="badge badge-font bg-warning text-dark">POSTPONED</span>
                            <span th:case="'CANCELLED'" class="badge badge-font bg-danger">CANCELLED</span>
                            <span th:case="'DRAFT'" class="badge badge-font bg-secondary">DRAFT</span>
                        </span>
                    </td>
                </tr>

                <!-- Empty state -->
                <tr th:if="${#lists.isEmpty(events)}">
                    <td colspan="5" class="text-center text-muted py-3">
                        No events available
                    </td>
                </tr>
                </tbody>

            </table>
        </div>

        <!-- Pagination -->
        <nav th:if="${totalPages > 1}" class="mt-4">
            <ul class="pagination justify-content-center">

                <!-- Previous -->
                <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                    <a class="page-link" th:href="@{/home(page=${currentPage - 1})}">Prev</a>
                </li>

                <!-- Page Numbers -->
                <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/home(page=${i})}" th:text="${i + 1}"></a>
                </li>

                <!-- Next -->
                <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                    <a class="page-link" th:href="@{/home(page=${currentPage + 1})}">Next</a>
                </li>

            </ul>
        </nav>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:src="@{/js/home.js}"></script>
</body>
</html>